!function(wndw){var src=/.*\/204\.(min\.)?js(\?.*)?$/;var _204v="0.02";var parse=function(data){var qs=[];for(var key in data){if(typeof data[key]!="string"&&wndw.JSON)qs.push(key+"="+encodeURIComponent(wndw.JSON.stringify(data[key])));else qs.push(key+"="+encodeURIComponent(data[key].toString()))}if(!wndw.JSON)qs.push("_noJSON_=true");return qs.join("&")};var post=function(beacon,data,callback){var iframe=document.createElement("iframe");var uniqueString=(new Date).getTime().toString();document.body.appendChild(iframe);iframe.style.display="none";iframe.name=uniqueString;iframe.contentWindow.name=uniqueString;var div=document.createElement("div");div.style.display="none";var form=document.createElement("form");form.target=uniqueString;form.action=beacon;form.method="POST";div.appendChild(form);var input;for(var key in data){input=document.createElement("input");input.type="hidden";input.name=key;if(typeof data[key]!="string"&&wndw.JSON)input.value=wndw.JSON.stringify(data[key]);else input.value=data[key].toString();form.appendChild(input)}document.body.appendChild(div);iframe.onload=iframe.onreadystatechange=function(){if(!this.readyState||this.readyState=="complete"){iframe.onreadystatechange=iframe.onload=null;iframe.parentNode.removeChild(iframe);form.parentNode.removeChild(form);if(callback&&typeof callback=="function"){callback()}}};form.submit()};var ping=function(beacon,data,callback){var script=document.createElement("script");script.type="text/javascript";script.async=true;script.src=beacon+"?"+parse(data);script.onload=script.onreadystatechange=function(){if(!this.readyState||this.readyState=="complete"){script.onreadystatechange=script.onload=null;script.parentNode.removeChild(script);if(callback&&typeof callback=="function"){callback()}}};script.onerror=function(){post(beacon,data,callback)};document.getElementsByTagName("head")[0].appendChild(script)};var indentity=function(_){return _};var cookie={set:function(key,value,options){options=options||{};if(value===null||value===undefined){options.days=-1}if(typeof options.days==="number"){var days=options.days,t=new Date;t.setDate(t.getDate()+days);options.expires=t}if(!options.path)options.path="/";var encode=options.raw?indentity:encodeURIComponent;var cookie=encode(key)+"="+encode(String(value));cookie+="; path="+options.path;if(options.expires)cookie+="; expires="+options.expires.toUTCString();if(options.domain)cookie+="; domain="+options.domain;if(options.secure)cookie+="; secure";document.cookie=cookie;return cookie},setOnce:function(key,value,options){var currentValue=cookie.get(key,options);if(currentValue===null){cookie.set(key,value,options);currentValue=value}return currentValue},get:function(key,options){options=options||{};var decode=options.raw?indentity:decodeURIComponent;var pairs=document.cookie.split("; ");for(var i=0,pair;pairs[i];i++){pair=pairs[i].split("=");if(decode(pair[0])===key)return decode(pair[1]||"")}return null},remove:function(key,options){options=options||{};options.days=-1;cookie.set(key,null,options)}};var generateSessionID=function(){return(Math.random()*1e10).toFixed()+"-"+(new Date).getTime()};var removeCookies=function(keys,options){for(var i=keys.length-1;i>=0;i--){cookie.remove(keys[i],options)}};var initialize=function(twoohfour){twoohfour.options.session=twoohfour.session();var key=twoohfour.options.initialReferrerTracker;var options={domain:twoohfour.options.domain,days:365};twoohfour.options.initialReferrer=cookie.setOnce(key,twoohfour.options.from,options)};var TwoOhFour=function(){var scripts=wndw.document.scripts||document.getElementsByTagName("script");var count=scripts.length;var referrer=wndw.document.referrer;var parts=wndw.location.host.split(".");while(parts.length>2){parts.shift()}this.options={user:null,version:null,session:null,client:"204",from:referrer,domain:"."+parts.join("."),currentURL:wndw.location.href,tracker:"__204u",initialReferrerTracker:"__204r",beacon:"https://eventing.coursera.org/info"};for(var i=0;i<count;i++){if(src.test(scripts[i].src)){var match=/^.+\?(.*)$/.exec(scripts[i].src);if(match){var params=match[1].split("&");for(var j=0;j<params.length;j++){var param=params[j].split("=");if(/client|user|version|tracker|beacon/.test(param[0]))this.options[param[0]]=decodeURIComponent(param[1])}}break}}initialize(this)};TwoOhFour.prototype.session=function(id){var options={domain:this.options.domain,days:365};var session=cookie.get(this.options.tracker,options);if(!session||id){session=id?id:generateSessionID();cookie.set(this.options.tracker,session,options)}return session};TwoOhFour.prototype.push=function(command){if(typeof command=="object"){if(Array.isArray&&Array.isArray(command)||command.constructor==Array){switch(command[0]){case"send":this.send(command[1],command[2]);break;case"tracker":this.options.tracker=command[1];this.options.session=this.session();break;case"session":this.session=this.session(command[1]);break;case"post":this.send(command[1],command[2],true);break;case"domain":var newDomain=command[1];if(newDomain!=this.options.domain){removeCookies([this.options.tracker,this.options.initialReferrerTracker],{domain:this.options.domain});this.options.domain=newDomain;initialize(this)}break;default:this.options[command[0]]=command[1];break}}else{this.send(command)}}return this};TwoOhFour.prototype.send=function(data,callback,isPost){if(typeof data=="string"){data={key:data}}else{data=data||{}}if(wndw.location.href!=this.options.currentURL){this.options.from=this.options.currentURL;this.options.currentURL=wndw.location.href}if(this.options.user)data.user=this.options.user;if(this.options.version)data.version=this.options.version;if(this.options.from)data.from=this.options.from;if(this.options.initialReferrer)data.initialReferrer=this.options.initialReferrer;data.session=this.options.session;data.client=this.options.client;data.url=wndw.location.href;data.time=(new Date).getTime();if(wndw.screen){data.screen={height:wndw.screen.height,width:wndw.screen.width}}if(isPost)post(this.options.beacon,data,callback);else ping(this.options.beacon,data,callback);return this};TwoOhFour.prototype.batch=function(batch){while(batch.length){this.push(batch.shift())}return this};var twoohfour=new TwoOhFour;if(wndw._204){if(typeof wndw._204=="object"&&wndw._204.constructor==Array){twoohfour.batch(wndw._204)}}wndw._204=twoohfour;if(typeof define==="function"&&define.amd){define("_204",[],function(){return twoohfour})}}(window);