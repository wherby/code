# 

【Tips】莫队算法的时候，用 n/sqrt(query) 作为块大小比用 sqrt(n)会更块， 计算分析 ： https://www.bilibili.com/video/BV1p3h3zYEbc/?spm_id_from=333.1387.homepage.video_card.click&vd_source=ca787d3785cbd6247961eba27850fa0c

为什么在莫队算法中采用奇偶块交替排序？
在莫队算法中，对查询进行排序时采用奇偶块交替排序（即对于偶数块按右端点升序排序，奇数块按右端点降序排序）是一种重要的优化技巧。这种处理方式的主要目的是减少指针移动的总距离，从而降低算法的时间复杂度。

1. 标准莫队算法的排序方式
标准的莫队算法会将所有查询按照以下规则排序：

主键：左端点 li 所在的块号（即 li // block_size）。

次键：右端点 ri 的值（升序）。

这种排序方式可以保证：

左指针 current_li 在块内移动时，最多移动 O(block_size) 次。

右指针 current_ri 在同一块内是单调递增的，因此总共移动 O(n) 次。

但它的缺点是：

当处理完一个块的所有查询后，右指针 current_ri 需要从最右端“跳回”到下一个块的起始位置，导致额外的 O(n) 移动次数。

如果有 O(sqrt(n)) 个块，右指针的总移动次数可能高达 O(n * sqrt(n))，这会使得算法的时间复杂度退化为 O(n * sqrt(n))。

2. 奇偶块交替排序的优化
为了减少右指针的“跳回”开销，可以采用奇偶块交替排序：

对于偶数块（block % 2 == 0），按 ri 升序排序。

对于奇数块（block % 2 == 1），按 ri 降序排序。

这样做的效果是：

在处理完一个偶数块后（ri 是递增的），下一个奇数块的查询会从右往左处理（ri 是递减的），因此右指针 current_ri 不需要完全跳回左侧，而是可以“反向扫描”。

类似地，奇数块处理完后，偶数块又会让 ri 递增。

这种交替扫描的方式使得右指针 current_ri 的移动更加连续，避免了大幅度的来回跳跃，从而将右指针的总移动次数从 O(n * sqrt(n)) 降低到 O(n)。

3. 为什么能降低时间复杂度？
左指针 current_li：

每次查询左指针移动不超过 O(block_size)。

所有查询的左指针移动总次数为 O(q * block_size)，即 O(q * sqrt(n))。

右指针 current_ri：

由于奇偶块交替排序，右指针在块间是“蛇形”移动的，不会完全跳回。

右指针的总移动次数从 O(n * sqrt(n)) 降低到 O(n)。

因此，算法的总时间复杂度从：

未优化：O(q * sqrt(n) + n * sqrt(n))

优化后：O(q * sqrt(n) + n)

对于 q 和 n 同阶的情况，优化后的复杂度是 O(n * sqrt(n))，比未优化的 O(n^{1.5}) 更优。

4. 举例说明
假设 n = 9，block_size = 3，查询的 li 和 ri 如下：

查询编号	li	ri	所属块 (li // 3)
1	1	2	0
2	1	5	0
3	4	7	1
4	3	8	1
(1) 未优化排序（全部按 ri 升序）
排序后顺序：[1, 2, 3, 4]（按 (block, ri) 排序）

处理 1: ri 从 -1 → 2（移动 +3）

处理 2: ri 从 2 → 5（移动 +3）

处理 3: ri 从 5 → 7（移动 +2）

处理 4: ri 从 7 → 8（移动 +1）

右指针总移动次数：3 + 3 + 2 + 1 = 9（即 O(n)）

(2) 优化排序（奇偶块交替）
块 0（偶数块）：按 ri 升序 → [1, 2]

块 1（奇数块）：按 ri 降序 → [4, 3]
排序后顺序：[1, 2, 4, 3]

处理 1: ri 从 -1 → 2（移动 +3）

处理 2: ri 从 2 → 5（移动 +3）

处理 4: ri 从 5 → 8（移动 +3）

处理 3: ri 从 8 → 7（移动 -1）

右指针总移动次数：3 + 3 + 3 + 1 = 10（仍然 O(n)）

虽然这个例子中优化后的移动次数略高，但对于更大的 n 和更多查询，优化效果会更明显。

5. 总结
标准排序：右指针可能会在块间大幅跳回，导致额外的 O(n * sqrt(n)) 移动。

奇偶块交替排序：右指针“蛇形”移动，避免完全跳回，将总移动次数降低到 O(n)。

适用场景：当查询次数 q 和 n 同阶时（如 q = O(n)），优化后的复杂度更优。

因此，莫队算法中采用奇偶块交替排序是一种经典优化，能显著减少指针移动次数，提高算法效率。

