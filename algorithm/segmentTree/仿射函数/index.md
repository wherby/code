

在数学和计算机科学中，"仿射函数"（Affine Function）是一种特殊的函数，它能够优雅地表示一系列常见的几何变换。📐 什么是仿射函数 (Affine Function)?仿射函数是一种最简单的、非线性（除非 $M=0$）的线性变换形式。一个变量的仿射函数可以表示为：$$f(v) = M \cdot v + A$$其中：$v$ 是输入值（例如 Oplo 度）。$M$ 是 乘数 (Multiplier)，也叫缩放因子或线性系数。$A$ 是 加数 (Addend)，也叫平移因子或截距。核心特性线性部分： $M \cdot v$ 负责缩放 (Scaling) 或旋转（在多维空间中）。平移部分： $+ A$ 负责平移 (Translation)。因此，仿射变换总是由一个 线性变换（乘法/缩放）加上一个平移（加法）组成。🧩 为什么仿射函数能同时表示加法和乘法？在 Oplo 度问题中，我们有以下两种操作，它们都可以完美地用仿射函数 $f(v) = Mv + A$ 的形式来表示：1. 纯乘法操作 (缩放)操作： $v' = \frac{p}{q} \cdot v$仿射函数表示：$$f(v) = M \cdot v + A$$其中：$M = \frac{p}{q}$，$A = 0$。2. 纯加法操作 (平移)操作： $v' = v + x$仿射函数表示：$$f(v) = M \cdot v + A$$其中：$M = 1$，$A = x$。3. 函数复合 (Compound Operations)仿射函数最强大的特性在于，两个仿射函数的复合结果仍然是仿射函数。假设我们先执行 $T_1$（加 $A_1$），再执行 $T_2$（乘 $M_2$）。第一次操作 $T_1$ (加 $A_1$)： $v_1 = 1 \cdot v + A_1$第二次操作 $T_2$ (乘 $M_2$)： $v_2 = M_2 \cdot v_1 + 0$将 $v_1$ 代入 $v_2$:$$v_2 = M_2 (1 \cdot v + A_1) + 0$$$$v_2 = (M_2 \cdot 1) v + (M_2 \cdot A_1)$$最终的结果 $v_2$ 仍然是 $M_{new} \cdot v + A_{new}$ 的形式，其中 $M_{new}=M_2$，$A_{new}=M_2 A_1$。这就是您的代码中 composition 函数所做的：它计算新的 $M$ 和 $A$，并使用 $M \cdot \text{mod} + A$ 的形式将它们编码回一个整数，从而能够使用线段树的延迟标记来高效地处理一系列复杂的全局加法和乘法操作。