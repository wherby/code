

您对问题的分析非常深入且完整，特别是引入了格基、拓展欧几里得算法和极角范围等高级概念，这正是解决此类二维网格上路径规划问题的关键所在。您的分析揭示了问题的本质：找到一个最小的向量集 $T$，使得 $S$ 中的所有点都能通过 $T$ 中向量的非负整数线性组合（即只能在 $T$ 张成的锥内移动）到达。我将对您的分析进行总结、结构化和补充，并给出最终的构造方案。📐 基于格基和极角范围的最小向量集 $T$ 分析核心约束： $S$ 中的所有点 $(a_i, b_i)$ 必须表示为 $T$ 中向量 $\mathbf{v}_j = (c_j, d_j)$ 的非负整数线性组合：$$(a_i, b_i) = \sum_{j=1}^{|T|} k_{ij} \mathbf{v}_j, \quad k_{ij} \in \mathbb{Z}^+ \cup \{0\}$$这要求 $S$ 中的所有点必须位于 $T$ 中向量张成的锥（Cone）内。1. 最小尺寸 $|T|$ 的上限提示 1 提到 $|T| \le 3$。如果 $T = \{(-1, -1), (0, 1), (1, 0)\}$，任何点 $(a, b)$ 都可以通过以下方式到达：先使用 $k_1$ 次 $(-1, -1)$ 向量将坐标退回到一个足够大的负值 $(x_0, y_0)$，使得 $x_0 \le a$ 且 $y_0 \le b$。然后使用 $k_2$ 次 $(1, 0)$ 和 $k_3$ 次 $(0, 1)$ 向量，从 $(x_0, y_0)$ 移动到 $(a, b)$。$$k_2 = a - x_0, \quad k_3 = b - y_0$$由于 $k_2, k_3 \ge 0$，这种方法总是能到达任何格点。因此，最小尺寸 $|T|$ 必然不超过 3。我们只需要检查 $|T|=1$ 和 $|T|=2$ 的情况。2. $|T|=1$ 的判断和构造条件： $|T|=1$ 成立当且仅当 $S$ 中的所有点 $(a_i, b_i)$ 位于同一条以原点为端点的射线上。几何判断 (共线且同向)：所有 $S$ 中点必须共线（任两点 $(a_i, b_i), (a_j, b_j)$ 的叉积 $a_i b_j - a_j b_i = 0$）。所有 $S$ 中点必须位于同一侧（例如，所有点的 $x$ 坐标符号相同，且所有 $y$ 坐标符号相同）。构造 $T$：找到 $S$ 中所有非零点所张成的一维格的基本基向量 $\mathbf{v}_{base} = (c, d)$。$c = a_k / g$, $d = b_k / g$，其中 $g$ 是 $\text{gcd}(\{|a_i|\} \cup \{|b_i|\})$ 的某个因子，使得 $\mathbf{v}_{base}$ 是最小的互质向量。$T = \{\mathbf{v}_{base}\}$。3. $|T|=2$ 的判断和构造（极角范围分析）如果 $|T|=1$ 不满足，则最小尺寸为 2 或 3。核心： 两个向量 $\mathbf{v}_1, \mathbf{v}_2$ 只能通过非负线性组合到达它们张成的锥内的点。如果 $S$ 中的点分布在这个锥之外，则 $|T|=2$ 不成立。几何判断 (极角范围)：将 $S$ 中所有非零点视为方向向量。计算这些向量的极角范围 $\Delta\theta$。如果 $\Delta\theta \le \pi$（即 $180^\circ$），则存在一个半平面，该半平面包含所有 $S$ 中的点。如果 $\Delta\theta > \pi$，则 $S$ 中的点散布太广，任何两个向量张成的锥都无法覆盖所有点。此时 $|T|=3$。构造 $T$（$\Delta\theta \le \pi$ 成立时）：此时最小尺寸为 2。我们选择 $T$ 中的两个向量 $\mathbf{v}_1, \mathbf{v}_2$ 作为 $S$ 中所有点张成的格 $L(S)$ 的基，同时它们也充当 $S$ 极角范围的边界。确定 $S$ 的边界向量： 找到 $S$ 中极角最小的向量 $\mathbf{v}_{min}$ 和极角最大的向量 $\mathbf{v}_{max}$。构造格基：设 $\mathbf{v}_1 = (x, y)$ 为 $\mathbf{v}_{min}$（或 $\mathbf{v}_{max}$）的互质版本（即 $x, y$ 互质）。我们需要找到第二个向量 $\mathbf{v}_2 = (n_x, n_y)$，使得 $\mathbf{v}_1$ 和 $\mathbf{v}_2$ 构成 $L(S)$ 的一个基本格基。这需要它们张成的最小面积为 $1$（即 $\text{det}(\mathbf{v}_1, \mathbf{v}_2) = |x n_y - y n_x| = 1$）。使用拓展欧几里得求解 $\mathbf{v}_2$：我们要求解丢番图方程 $x n_y - y n_x = 1$ 或 $x n_y - y n_x = -1$。由于 $\text{gcd}(x, y) = 1$，根据拓展欧几里得算法，方程 $x n_y - y n_x = \text{gcd}(x, y) = 1$ 有整数解 $(n_x^*, n_y^*)$。构造 $\mathbf{v}_2$ 为 $(n_x^*, n_y^*)$。调整 $\mathbf{v}_2$（消除负系数）：初始解 $(n_x^*, n_y^*)$ 只是格基，但可能不在 $S$ 的极角范围内。为了确保 $S$ 中所有点 $(a_i, b_i)$ 都能表示为 $k_1 \mathbf{v}_1 + k_2 \mathbf{v}_2$ 且 $k_1, k_2 \ge 0$，我们需要将 $\mathbf{v}_2$ 调整到 $\mathbf{v}_1$ 的逆时针方向（使得 $\mathbf{v}_2$ 落在 $\mathbf{v}_{min}$ 和 $\mathbf{v}_{max}$ 之间）。新的 $\mathbf{v}_2' = \mathbf{v}_2 - K \mathbf{v}_1$，其中 $K$ 是一个整数，用于平移 $\mathbf{v}_2$ 到合适位置。这种构造的 $\mathbf{v}_1, \mathbf{v}_2'$ 不仅是格基，而且它们张成的锥恰好包含了 $S$ 的所有点，保证了所有点的非负整数线性表示。4. 最终答案的确定| 最小尺寸 $|T|$ | 条件 | 构造 $T$ || :--- | :--- | :--- || 1 | $S$ 中所有点共线且同向。 | $T = \{\mathbf{v}_{base}\}$ (最小互质向量)。 || 2 | $S$ 的极角范围 $\Delta\theta \le \pi$ ($180^\circ$)，且 $|T| \ne 1$。 | $T = \{\mathbf{v}_1, \mathbf{v}_2'\}$ (由拓展欧几里得和调整得到的格基)。 || 3 | $S$ 的极角范围 $\Delta\theta > \pi$。 | $T = \{(-1, -1), (0, 1), (1, 0)\}$ (通用解)。 |您的分析为我们提供了一个完整的 $O(N + \log M)$ (其中 $M$ 是最大坐标值) 的高效算法。需要注意的是，在实际编程中，叉积是判断点是否在 $180^\circ$ 范围内的最安全方式，因为它避免了浮点数运算：找到一个点 $\mathbf{p} \in S$ 作为参考点。检查所有 $\mathbf{q} \in S$ 是否满足 $\text{det}(\mathbf{p}, \mathbf{q}) \ge 0$ 或 $\text{det}(\mathbf{p}, \mathbf{q}) \le 0$（即所有叉积同号），表明它们都在 $\mathbf{p}$ 的某一侧 $180^\circ$ 范围内。这是解决此类问题的标准方法，涵盖了所有几何和代数约束。