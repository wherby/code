# from ./pic/stringHash.png
# Add Random https://leetcode.cn/problems/minimum-number-of-valid-strings-to-form-target-ii/solutions/2917929/ac-zi-dong-ji-pythonjavacgo-by-endlessch-hcqk/

# will generate different answer
# (base) tao@MacBook-Pro code % /usr/local/bin/python3 "/Users/tao/software/code/algorithm/string/stringHash/wrongVersion/stringHash.v2 .wrong.py"
# 518
# (base) tao@MacBook-Pro code % /usr/local/bin/python3 "/Users/tao/software/code/algorithm/string/stringHash/wrongVersion/stringHash.v2 .wrong.py"
# 2599


from typing import List, Tuple, Optional
from collections import defaultdict,deque

from random import randint
#change to 131 will have consitent result
BASE =131 #randint(8 * 10 ** 8, 9 * 10 ** 8)
class StringHash:
    def __init__(self,s1):
        n =len(s1)
        self.hls =[0]*(n+1)
        self.pls =[1]*(n+1)
        
        self.mod = 2<<64
        for i in range(n):
            self.hls[i+1] = (self.hls[i]*BASE +(ord(s1[i]) - ord('a')+1))%self.mod
            self.pls[i+1] = (self.pls[i]*BASE)%self.mod
    
    def query(self,left,right):
        return (self.hls[right]- (self.hls[left]*self.pls[right-left]) % self.mod) % self.mod
    

class Solution:
    def minValidStrings(self, words: List[str], target: str) -> int:
        dic = defaultdict(set)
        for word in words:
            m = len(word)
            hs = StringHash(word)
            for i in range(1,m+1):
                dic[i].add(hs.query(0,i))
        n = len(target)
        hs= StringHash(target)
        cnt =0
        fd =True
        while n >0 and fd:
            fd=False
            for j in range(n,0,-1):
                if hs.query(n-j,n) in dic[j]:
                    cnt +=1
                    n = n-j
                    fd = True
                    break
            
        #print(n,cnt,dic)
        return cnt if n ==0 else -1

words =["ssssss","xxxxxxxxxx","ssssss","rrrrrr","nnnnnnnnn","eeeee","pppppppp","aaaaaaa","hhhhhh","qqqqq","lllllll","iiiiiiiiii","nnnnn","rrrrrrrr","ggggg","kkkkkkkk","ooooooo","iiiiiiii","iiiiiiiiii","lllllllll","dddddd","kkkkkkk","ppppppp","fffff","llllllll","fffffff","hhhhhhhhhh","aaaaaaaa","ddddd","oooooooo","gggggggg","mmmmmmmm","eeeeee","eeeeeeeeee","nnnnnnnnn","sssssssss","wwwwwwwwww","dcacdbcadbdadabddccbacbbdabcbbbdbaaacabcacbadcbaaabcdbddbbbcdbcccbabbbcababadbadadcbabcbdbbbddbdcababaadddbcbccaadabcaacdadbcddacdbccbbcadcdbadcaddadcdbbaabadbacbbadaaacdbccaccdddcbdcadbbcdadcbdbccdcdcadcdaadabbdadadbcdcddbadbbcdcdddbabcaccadccdbbdddcbbbccdddcbbcdcbcdacaaabccdcdbcaadccdcaaacccbacdabbbbadbcbaabbabaddbbbcccccddacabcadadbddbbbdcaaabaccdabdbddaadbdabdcaacbbccbbbbcadcabcbcbbbbbcccaadddbadbbabdacccddbddbbadbdcbcbdaabdbbcddbacabcbbccdabcbdacabcccddbdccacabcadddcdcaabcbbbbcbdbcddbbcdcdbbdbddabccbbbcaaabadcbabbbdbdbabbaabcaadbdbbbacdbdcdabdbbdbabcbdadacdddcbbcdcbcbcadcdddbcbbbbbcdccadbabdacbcdabacacadbbdcbbbaaacdcaabcbbbbbbbcdbdbadcccabcbcbcbabcdaacabcdcdcbaaabbdcddcdacddbcaacaddaaaadbccdbaaaaddddbaddcccabdcacbaaccddbcccaacbabaadbbbacdcbbacaaaabbbacdbdbcbbbbbcdcbdcaadbabadcadddcbaadacdbbdaabbcbdaabcdbccbcacaadcabcdacbcadccdcaccdcacbdcaadbdacadbdccccabaaacdabaacdcbbcabdcaadbccbaddbccdabcaacccababaacabdbbbbcdddbcaadabdabcdddddaacaddadbbabdcbcbbbcbcdadbddbabcacccccdbbcadbdbccdbcabcaabaaccadbaaddcddbddaaccccbcadacaadbcbdadbbadabacdabccdcabaacacbabadcbdcddcadabbdabbccdccacabacabbbcbdaaabbacabcdcdcbbaaabcdadcabbcccbadcdadbcaacaccacabaccdaaacadbbbcdbdcacabbdbabcaadadcbaddabcbdbbdbbbdbcacbabadcbadabbcdadbbbcddaadbcdcbbdbccaccaaaaadabbdcacdccbcddacdaabaabbbddcaabbddcbccbccddabddbbcabcadcddccacabdacdaaccbbbbcbababaadacaacaabbdabbaabcddbcadabcaaddaabdadbbdcaadcdcdcbabdadbccbbbccadabadbbdcccdaadaacdadcaccdcabbdacaaccddbacabccababdcddcbccbdaadccdadadcdbbcbcaddaaadbdcdbcddabbcdbabddccadacdbbdbbaccddcccbbaaadaccacbdcdcaaacbdcbabbbacdddaacacdadbdadadcdbaaccbbddbcaacddaacbddccdaccacccdacacdadbdcdddbcdbdacbbbcaacaaaddadddacdcaaddcdaaadacdbcbdbbbdccddaadbdaabbcbdaddbdaaddaabbdaacbcaadabcdccbbcadacdcaddddcabdddacdacaddcaaaccdddaccccbbadbddcaaaabbadbaaadcaacdaaaaaddbddccbcdbcacdcccdbadabbacbdaccaddcccabbdddcbdddcbcbaddaddadcdbbdddacdabdaddcdbbaccddccbbbcaddabadbacacdbdabbbccdabbacbcaabbdccdbcaacaddcadaaababcbdbbaadbbacaccbcababcdacbcadddadbbbdcbdbaacbacbcdaccabdcdbaabccaddddcbacbddbdacabdbadccccbcbbbcdaaaadaadabbbccdbdcdaadcadbbbacdbcadaabaacabdcaccddaabadabcbcbacaabbdbbcddcdbaaabbabadcccbdabbabddaccdabadbccbacacbdbaccbaadacdbaccbadcdbdaadadccdadbdccbdbaacddacbcababaacccccdabcaabcbbddcadaaaacbbdddbcaccbcccacbaacddabcbdcabccbacdbdddcadcbaaabcddddcbabddadddbdccadddaaddacdabacdcccccaddccaadcccbdbbabbbadadbcabdbaadababddaacbdabbccdcdcbcaacdbbdabbbdbcbabdadbdbbcaaaadabddabbaacbdcacaacadacacddccbdddcaabdddccbbdcddacbaadbbbbdcaaaaaacabdcadbdabdccacccabbdbccbdddadcaabacbddacbcbaaabadbacbdccacbdbaadadbccacccacccabaaadbbdcdccccccbddadcacacccaddaababbadbbdccccaacadcaccccdbccbaaaccccbdacacabbcdbabdccdbcdaabdbcdbcccbbbbaccbadbadcdbadcaadcadbbacdcdbdaccbbbabbdbabcdbcccbdbadbdbdabbbcabbabddacdcddababbccaacdcbcbbcdcbcaacaabacadcbaabbddadccbbbcccbbbdcbcdbacbbacacbdbdbabcbbcaaacadbcbdbdbaadadacdadaaccaadbbbbbaddbccacbacdbbcdbcaaabccdcbbbcddbcdaacaddcaaacaabbabcbbccdbbabcabcdccacbadbdccbbbdacbcdcdbbdaaaabcbdbaadaabcddadccdcddccdddbdabcaddbbcddabbaddddbcaaaaddacbcdbddcbdbacdbdddcadcbbaaccddccadcbcabbadbbccbcadabccabbcacbddbaccbcddccaabbadddbbaadadbabddbdcbacbcbddaabcbddcbddbaaccbcbdaacabacdbadacdbdadcbadaabccbbaabadcaadcccbaaacdcbacbddcdaadabddaddcddcddcdaadddaacabcddababbcbbbdadadccadddccadabdabcbaabbaaabcbacdcbbadbddcddddabbabdabaaabcddabddddddcbcddddacadbbacacdaadaccaadccbbadcdabdabbcddcddadacaccdcabccbcbaddcccdbddbccdbccdcaaacaaacaadaabcbbcbaddabacbccdddaabddabbbcdbcbccbddccdcddbaddbbbbcacbccbbbcdaccbbbdabaadccdcacbdacdbccbcccdbdadbcbbdccddbadddbacbabdbadadbadcddcbbdcccabbdabbadccccddadccbadabacdcdcbbdabdaccdbccbdacadadaabdcbcbacbdabbcbacdadbacdadbacaacaddcbabaacdbbdcbccbabbcbcccdabdccabbdbbdcdacabadcddadddabdcdacbbbbddbbabcddbcdccccbdbabbbbacacccbcdddaaaaadababdbbddbddbbabdabbccddbccabdcabcacdabbccaddbdcbabccdbcadcbcabaadbdcbabbbcbccbcbaacbbadbaabbdaadabccbbdbbacbbccababaacccaaccbccdbaddcadddbaaddaadbbdbabbacbadbbadcaadacccdabdabcdbddacadbbacbddcdddacbdcdddbbaabbdbcacbbabddaadbacaddabaddabcdaddbbdbaadcbbdaadacbdacdacccaddbabbacdbaddcdaacddddbcdaaddccdacabadbcadcdcdbbabddccacbacdbdacbaaadcabbdccbdaacccabbcdcbcadabdadabacbccadbdbcbdccbbddcacabbcdcadaaddcbbababcabbdacccccabbdcdcccdcabcaabaadcadaccbcacbbdbbacdbbdccbadcabdddbacddabbaacbaaddcbcdbccbcadcbdadadaaaccacaccbcdcbdadbdaaaddaaaacdadcdbbaaaadddbaadcbcbbababdcdcbdbbdbdccbdddddcbcbbdadcabacbacdadacaddccbdcdabadbdacccddaabdbcabbbbadccbccdcbbddaacacbdbddadbbbadbdddbcacacdbbcacccbbdcaababdaabacbbdaccbbcdbcabbdcdaddddddbcddcadacacbcdccacbbadcbbbdcbcaaddbbaaadbacdddcacaccbdbcadaaddbcddddbaabacbbacdcabcbcdddadccbdbacbcbacddbbadddcdcbdaaadaabbadbabddacdadaaacadabacdcabcaadddccccbcdcdabcdaacaddacaacddadbbccbbadbabcdbccadacbbcbcabcaadcdbdcacddbbcbaacdaabdddabdbabbcdacacdcbadacadcdcbbacccddcddbdaddcabbbcdbdddcaaddcabaaabbdbacababcabdccdbadcbddbbaaadcbdaddbacacdcbbcbdccaaabadccbcadccdbbcdaaddbaccbccdbddbdbacdcaacccadbbabcaaaabaccccadcaadcaccaabaddcaddaacdaadccbcabcccccbdddcbaadcaadcdbbabbacbccdabccccbdbacbdbbcdadbbcdbdddbbccdbccdccddaabbbbabbcdcbdbcbabaddbcddcdcacdcbcbbaddbcdabbddaadbbcccaabcadd","bbbbbbb","cccccccc","dddddddd","cccccccccc","mmmmmmmmm","bbbbb","zzzzzzzzzz","mmmmmmmmm","eeeeeee","ttttttt","jjjjjjjjj","wwwww","aaaaaaaa","lllllllll","cccccc","sssssss","vvvvvvvv","tttttt","qqqqqqqqq","oooooooo","aaaaaaa","mmmmmmm","uuuuuu","wwwwwwww","uuuuuuuuu","tttttttttt","yyyyyy","nnnnn","kkkkkkkk","pppppppppp","jjjjjj","bbbbbb","hhhhhhhhhh","gggggg","rrrrr","ttttttttt","vvvvvvvvv","bbbbbb","kkkkkkkk","gggggg","xxxxxxx","oooooooooo","vvvvvvv","xxxxxxxx","dddddddddd","yyyyyyyyyy","hhhhhhhh","ppppppppp","ffffffffff","fffff","uuuuuuuuuu","jjjjjjj","rrrrrrr","yyyyyy","zzzzz","uuuuu","zzzzz","jjjjjjjjjj","iiiiii","qqqqqqqq","qqqqqqq","cccccc"]
target ="aaaaaauaaaaaaaaqqaaaqqaassaaaaaaaaaaabttaaaaaaaaaaaaaaaaaaaicajggaaaaaaabbbaaaaaavaaaaaaaaaaaaaddaaaaaaaaaaaaaaaaaaaaaaaaaabbbaaaaaaaaaaaffaaaaamaaaaaaaaooatttaaaaaaaaaaaaaaaaaaaaaammaaagggaaaaaaaaaaaaaaaaaqqqaaaaaalmllbqhhaabbbaaaaaaaaaaazaaaaaaaattaaaaaaaaaaaaaaaaaaaabaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaagaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaannnnggaaaaaaaaaapppaffaaaaaaiaaaaaaaaaaaaaaaaaaaaaxxxxaaaaaaaaanaaaaaaaaaaaaaaaaaaaaaaaaaaaaaannnnaaaaaaaaazaaaaaaaaaaaaaaaaaaataaaaaaaaaaaaabbbaaaaazzasaaaaaaaaaaaaaaaaaaaaaappppmmmmaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaggaaaaaaraaaaaaaaaaaaacaaaaaaaaaaaqqqaaaaaaaaaaaaaaaaaaaaaaaaaaaqaaaaaaaqqaaaaaaaaaaaaaaaaaaaaaapppahhhhhaaaaaaaaaaaaaaiiiiiaaaaaaaaaaaaaaaaaaaaaaaaaaaagggaaaaaaaaeeaaaaaaaaaattttaaaaccaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaalaaaaaaaaaaaaaatttabbcccwwwaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaccccaaaaaaaaaawwwwaaaaaaaeaaaaaaaaaaaaaaaaaaaaaaattttaaaaaaaaaaaaaaaaawwwwpddddaaaaaaaaaattaaabaaaaaaaaaaapvvaaaaaaaaaaaaaaaadcacdbctdbdadabiiccbacbbdabcbbbdbaaacabcacbadcsaaabcnnddbbbcdbcccbabbbcabagadbadadcbbbcbdbebaazzcababaadddbcbccaadabcaacdadbcddacdbppppooocdbadcalladcdbbzabadbacbbadaaacdbccaccdddcbdcadbbcddcacdbcadbdadabddcacdbccdbdadabdggcbacbbrrbcebccbaaacabcacbadcbaaabcdbddbbbwwbcccbabbbcababadbadadcbabcgggbbltffoffabaadpdbcbcyaadabcaacdadmmddkuubccbbcadcdbadcaddadcdbbaabadbacbbadaaacdbccaccdmdcbdcadbbcdakkkdbwwfrrcadcdaffabudadhdbcdcddbasbbidcdddbabfddcadccdbbdddcbbbccdddcbbcdcbcdaclllbnnnggbcwrrccdcahhhhhbzcdabbbbambcbaabbabaddbbttcctxddacabcadadbddbbbdcttttaccvvbdbddaagggabdvaaffbccbbbbcadcabcccbbwwbcccabbbdbadbbabdacdddduddbbadcccbcbdaarrrbcddbacabbbbccdabcbdacabcccdzzdccacabcadddcdcaabcbaffcbdbcddbbcdcdbbdbtttbccbbbcaaabadcbabbbdbdbabbccccaadbbbbbacdbdcdqwdbbdbabcbdadacdddcbbcdcbcbcadczddbcbbbbbcdccadbabdacmcdabawwwwiiiicbbbaaacdcaabcbuubbbbcdbdbadcccabcbcbcbabcdaacabcrrrcbaaaggdcdbeeecddbchhbbbdaaaadbccdbaaaaddddbaddcccabdcacbqqeaaaacccaaooobaadbbbacdcccacaavvbbbaddddcacdbcadbdadabddccbacbbdabcbbbdbaaacabcacbadcbaaabcdbddbbbeebcccbabbbzzbabadbssadfbabcbdbbuddxdcannnllbbbbcbccaadabcaacdaxxcddacdbccbdcadcduadcaddadcdbbmmmmdbacbvabbbacdbccaccjjjcbdsllqqcdadcboooodcdrtdcdaadabbdamrrbcdcddbadbbcdcdddbssssccadcgdbbdoocbbbccdddcbbcdcbcdacaaabccdckkcaadccdcaaacccbacdabubbadbcbaabbalssssbbcccccddacabcadadbddbbbdcaaammmcdabdbddaadbdabdcaiibbccbbbbcadcabcbfbbbbbcccaadddbadbbabdacccddbddbbadbdcbcbdaabdbbwdddcacdbcadbdadabddccbacbbdabcbbzzzzzacabcacbadcbaanncdbddbbbcsscccbabbbuababaddddadxxaacbdibjjjjdcababaadddbcbccaawabcaacdadbcddacdbccbbcadcdbadcaddadcdbbaabadbaaaaadaaacdbccppcdddcbdcadbbcdadcbdbccdcddadcdaadabbdadadbcdcddnndbbcdcdddbabnnnnadccdbgdddcbabccdddcbbcdcbcdacanabeedcdbcaqqccdcaaacccbacdabbbbadbcbaabbadddffbbcccccddacabjjjadbudbbbooatttaccdabdbddaadbdabdcaacbbccbbbbcadcabcbcbbbbbcccasdddbadbbabraciizzbnnbbjjjjcbcbdwwwdbbcdwwacabcbbccdabcbdacamcccddbdccacabcpppdjjjaabcssbbcbdbcddbboocdbbdbddablcbbbcaaabadcbsbbbdbvvabbaabcaadbdbbbacdbdcdabdbbdbuucbdadacdddccccdcacdbcabddddabdddcbawwwwabcbbggbaaacabcacbadcbadctttbcadbdadabdssssacbbnabcbbbdbaaadfbcacbadcbaahhhhbdfffffdbcccbkbbbcababadbtttttbabcbdbbbddppcaballadddbcbccppppbcaackkmbcccacdbccbbcadcdbadcaddadcdbballldbacbbahhhmmmbccaccdddcbdcadbbzzadcbdbccdcdcadcdaadabbdadadbcdcddbadbbydcbddbabcaccadcndbbdddllbeeedddcbbcdcbcdacaaabdkkwwwwwdbdadabddccbacbbdabcbbbdbaaacabcacwwwwbaaabcmmmdbbbcdbcccbabbbcababavvvvadcbabcbdbbbddbdcababkkkkdwwwccaadqqcaaczzdbcddqqqbnntttadddbaeerrrdqddbbnnbadbacbbadaaacdbccsssdddcbdcadmmmdrrcbdbcooodcadcdaadabbdadadbcdcddbadbbcdcdddbabcaccadccdbbddtttbbccdddcbbcdcbcnacaarrrrdcdbcardccuuaaacccbacdcacdbcadbdadabddccbacjjdabcbbbdbaaacabcachhhhbaaabcdbddbbbcdbcccbauuucababadbadadceabcbdbbbddbdcababattddbcbcqaadabccacdadbckdacdbccbbcadcdbadcaddadcgggaabadbacbbadaaacdbccaccdddcbdcadbbcdadcbdbccdcdcajsjjakkkbdadadbcdcddbadbbcdcppdbapppccadcctttddgcbbbccoodcbbcdclcdacaaabccdcdbcabbbcdcaaahhciicdabbooooocrrabbabaddbbbcccccddacabeadadbddjjbdcaaabacbbbbdcbcbcbabadffcabcdcxxuxxabjdcddcdauuuyyynnahhhhhadbccdbaazaddddbaedcccajjjawzzaccddbcccnnhhhbaadbbbacjjjbacaaaabbbacdbdxxxbbbbcdcbdcaadbabadcadddcbaadacdbbdaabbcbdaahcdbccbcacaadcabcdacbcadttdcaccdcacbkkkadbdacadbdccccabaaacdabaacdcbbcabixxadbccbaddbccdqqcaackkvbabaacabdbbwwwwwdbcoadabdxbcdddddaacaddadwbabdckcbbbuucyyybddbabcacccccccbcadbdbccdbcebcaabtttcadbaaddcddbddaaccbbbcadacaadbcbdadbbadabauuabccdcattttacbabadkodaaaaadagbdabbyydccavabauabbbcbdaaabbaaabcdcsssbapabxxxdcabbckkkaocdadbcpppaccachhaccdaaacadbbbcffdcacabbdbabcaadadcbaddabcbdbbubgbdbcttbabadcbadakkhhadbbwwddaadbedcbbdbccaccaaaaadabbdcacdccbcddatttabaabbbdaaaaaiiiiapppaasaaaaauaaaaaaaaaallllaaaaaaaaaaaaaaabbaaaiiiiaaaaaaaaavaayyaaaaaxxaaaaaagaaaaaaaaaaaapaaaiiiiiaaaaaaaaaaaaaaaakkaaannnnaaaaaaaaaaaaaaaaaaaaaaaaaayyyaaaaaaaaaaaaaaaalllaaaaaaaaaaaaaaaaaaaaooaaaaaaaaaaataaaaaaaaaaaaaaaaaaaaaaaaaarraaaaaaaaaaaaaaaaaaaaaqaaaaaaaooppppaakkkkaaaaaaaaddaaaaaaaaaaauaaaaaaaaavvaaaaaaaaaaaaaaaaaaaazaaaaaaaaaaaaaaaaaaaaaaxxxaaaaaaaaaaaaaaaaaaaaaaa"
#re =Solution().minValidStrings(["b","ccacc","a"],"cccaaaacba")
re =Solution().minValidStrings(words,target)
print(re)

